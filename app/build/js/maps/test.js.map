{"version":3,"sources":["test.coffee"],"names":[],"mappings":"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","file":"test.js","sourceRoot":"/source/","sourcesContent":["app = angular.module \"testApp\", []\n\n###\n# fix https://github.com/angular/angular.js/issues/9269\n###\napp.directive \"rangeParser\", () ->\n  return {\n    restrict: \"A\"\n    require: \"ngModel\"\n    link: (scope, element, attr, ctrl) ->\n      return unless ctrl?\n      ctrl.$parsers.push( (value) ->\n        val = Number(value)\n        val = null if val != val\n        return val\n      )\n  }\n\napp.constant \"defaultSum\", 100\n\n# TODO show float precision (toFixed or something else)\napp.directive \"commaDetect\", () ->\n  return {\n    restrict: \"A\"\n    require: \"ngModel\"\n    link: (scope, element, attr, ctrl) ->\n      return unless ctrl?\n      oldV = null\n\n      check = (value) ->\n        return unless value?\n        return if parseInt(value) > 100\n        return if value.match(/^\\-/)\n        if value.match(/\\.$/)\n          oldV = parseInt(value)\n        else\n          oldV = null\n\n        tVal = value.replace(/,/g,\".\")\n\n        if tVal != value\n          ctrl.$setViewValue tVal\n          ctrl.$render()\n\n        if oldV?\n          value = oldV\n        else\n          value = tVal\n\n        value\n\n      ctrl.$parsers.push check\n  }\n\napp.service \"Data\", ->\n  @dataNull =\n    items: [\n      name: \"item1\"\n      percent: 0\n    ,\n      name: \"item2\"\n      percent: 0\n    ,\n      name: \"item3\"\n      percent: 0\n    ]\n  @dataNorm =\n    items: [\n      name: \"item1\"\n      percent: 60\n    ,\n      name: \"item2\"\n      percent: 10\n    ,\n      name: \"item3\"\n      percent: 30\n    ]\n  @dataBig =\n    items: [\n      name: \"item1\"\n      percent: 70\n    ,\n      name: \"item2\"\n      percent: 30\n    ,\n      name: \"item3\"\n      percent: 80\n    ]\n  @dataBig =\n    items: [\n      name: \"item1\"\n      percent: 70\n    ,\n      name: \"item2\"\n      percent: 30\n    ,\n      name: \"item3\"\n      percent: 80\n    ]\n  @dataBig =\n    items: [\n      name: \"item1\"\n      percent: 70\n    ,\n      name: \"item2\"\n      percent: 30\n    ,\n      name: \"item3\"\n      percent: 80\n    ]\n  @dataSmall =\n    items: [\n      name: \"item1\"\n      percent: 10\n    ,\n      name: \"item2\"\n      percent: 20\n    ,\n      name: \"item3\"\n      percent: 30\n    ]\n  @\n\n# MainCtrl\n# use common sum\n# use ng-change\napp.controller \"MainCtrl\", ($scope, $window, defaultSum, Data) ->\n  $scope.model = []\n  $scope.diff = null\n  $scope.defSum = defaultSum\n  $window.model = $scope.model\n\n  sumCompute = (items) ->\n    sum = _.reduce(\n      items\n    ,\n      (memo, item)->\n         memo+item.percent\n    ,\n      0\n    )\n    sum\n\n  findDonor = ->\n    donor = _.min(\n      $scope.model\n    ,\n      (item) ->\n        item.percent\n    )\n    donor\n\n  modItem = (item) ->\n    item[\"blocked\"] = false\n    item[\"getPercent\"] = ->\n      @percent\n    item[\"setPercent\"] = (points)->\n      if points == 1\n        @percent += parseFloat(points)\n      else\n        @percent = parseFloat(points)\n      @percent\n    item[\"incPercent\"] = (points)->\n      @percent += parseFloat(points)\n      @percent\n    item[\"decPercent\"] = (points)->\n      @percent -= parseFloat(points)\n      @percent\n    item\n\n  resolveProportion = (percent, sum) ->\n    return Math.round(percent*defaultSum/sum)\n\n  normalizeData = (data, sum) ->\n    _.each(\n      data\n    ,\n      (el) ->\n        el.percent = resolveProportion(el.percent, sum)\n    )\n\n  loadData = (dataType = Data.dataNull) ->\n    $scope.model.push(modItem i) for i in dataType.items\n\n  analizeData = ->\n    sum = sumCompute($scope.model)\n    switch\n      when sum == 0   then $scope.model[0].percent = 100\n      when 0 < sum < 100 or sum > 100 then normalizeData($scope.model, sum)\n\n  loadData Data.dataSmall\n  do analizeData\n\n  $scope.dirtySum = sumCompute($scope.model)\n\n  $scope.balance = () ->\n    donor = do findDonor\n    $scope.dirtySum = sumCompute($scope.model)\n    $scope.diff = $scope.defSum - $scope.dirtySum\n#    console.log \"donor \", donor\n    donor.setPercent($scope.diff)\n#    console.log \"donor \", donor\n    $scope.dirtySum = sumCompute($scope.model)\n    return\n\n  $scope.dec = (item) ->\n    item.decPercent(1)\n    do $scope.balance\n\n  $scope.inc = (item) ->\n    item.incPercent(1)\n    do $scope.balance\n\n  $scope.set = (item, percent = 1) ->\n    console.log item, percent\n    item.setPercent(percent)\n    do $scope.balance\n\n  return\n"]}